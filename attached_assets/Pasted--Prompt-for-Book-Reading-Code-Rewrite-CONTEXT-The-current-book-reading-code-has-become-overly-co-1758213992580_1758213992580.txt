ğŸ“‹Â Prompt for Book Reading Code Rewrite

CONTEXT: The current book reading code has become overly complex with heavy Redux state management, multiple service contexts, over-parameterized components, and intricate hook architectures. The goal is to create aÂ simpler, more maintainableÂ book reading experience that follows the clean patterns seen inÂ AdminBookUpload.tsx.
CURRENT COMPLEXITY ISSUES TO SOLVE:
1. Over-engineered State Management:
    * bookStore.tsÂ has 15+ state transitions, complex Redux actions, global state synchronization
    * useBookStateManagerÂ has 200+ lines managing Redux, API calls, and AI function calls
2. Heavy Service Dependencies:
    * StorybookDisplayÂ requires 15+ props includingÂ openaiConnection,Â workflowStateMachine,Â onAppuSpeakingChange
    * ServiceManagerContextÂ creates tight coupling between unrelated services
3. Functional Complexity:
    * Mixed concerns: UI display, state management, API calls, AI integration all intertwined
    * Function call handling for AI tools embedded deep in React hooks
REWRITE REQUIREMENTS:
âœ… KEEP (Core Functionality):
* Book search and selection
* Page-by-page display with images and text
* Page navigation (next/previous) with animations
* Audio playback integration for page narration
* AI integration (Appu can search books, display pages)
* Close/exit book reading mode
âŒ SIMPLIFY (Architecture):
* Remove Redux completelyÂ - Use simple React state likeÂ AdminBookUpload.tsx
* Eliminate ServiceManagerContext dependencyÂ - Direct API calls like admin page
* Reduce StorybookDisplay props from 15+ to ~5 essential ones
* Move AI function handling to simple API endpointsÂ instead of complex hook chains
* Use TanStack QueryÂ for API state management (like admin page)
ğŸ¯ TARGET ARCHITECTURE (Follow AdminBookUpload.tsx Pattern):
// Simplified book reading page structure
function BookReading() {
// Simple state (no Redux)
const [selectedBook, setSelectedBook] = useState<Book | null>(null);
const [currentPage, setCurrentPage] = useState(1);
const [pageData, setPageData] = useState<PageData | null>(null);
const [isPlaying, setIsPlaying] = useState(false);

// TanStack Query for API calls (like AdminBookUpload)
const { data: books } = useQuery({ queryKey: ['books'], queryFn: fetchBooks });
const { data: pageContent } = useQuery({
queryKey: ['book-page', selectedBook?.id, currentPage],
queryFn: () => fetchBookPage(selectedBook?.id, currentPage)
});

// Simple functions (no complex hooks)
const handleBookSearch = async (query: string) => { /* Simple fetch */ };
const handleNextPage = () => { /* Simple state update */ };
const handlePlayAudio = () => { /* Simple audio control */ };

return (
<div>
{/* Simple component with minimal props */}
<BookDisplay
pageData={pageContent}
onNextPage={handleNextPage}
onPreviousPage={handlePreviousPage}
onClose={() => setSelectedBook(null)}
/>
</div>
);
}

ğŸ“ NEW FILE STRUCTURE:
âœ… client/src/pages/BookReading.tsx - Main reading page (simple state)
âœ… client/src/components/BookDisplay.tsx - Clean display component (5 props max)
âœ… client/src/hooks/useBookAudio.tsx - Simple audio playback hook
âŒ Remove: bookStore.ts, useBookStateManager.ts, ServiceManagerContext dependency

ğŸ”— AI INTEGRATION (Simplified):
* Book Search: SimpleÂ /api/books/searchÂ endpoint (already exists)
* Page Display: SimpleÂ /api/books/:id/pages/:pageÂ endpoint
* AI Function Calls: Handle in parent component, not deep in hooks
ğŸ¨ UI REQUIREMENTS:
* Keep the beautiful animations and visual design from currentÂ StorybookDisplay
* Maintain page flipping animations and responsive layout
* Preserve audio integration and playback controls. Auto Play audio of the page and on completion, please handover to the next page
* Keep the same user experience, just simpler code architecture.
* Manage the pause in book reading when kid speaks something and let LLM decide to continue or not.
ğŸš€ SUCCESS CRITERIA:
1. Reduced complexity: <100 lines for main book reading logic
2. Fewer dependencies: No Redux, minimal context usage
3. Cleaner component props: BookDisplay has â‰¤5 props
4. Maintainable: Follows same patterns asÂ AdminBookUpload.tsx
5. Full functionality: All current features work (search, display, navigate, audio, AI)
DO NOT:
* Change the user experience or visual design
* Remove any core functionality
* Break AI integration (Appu should still be able to search/display books)
* Over-engineer with new patterns - keep it simple like the admin page

This prompt focuses onÂ architectural simplicityÂ while preserving all functionality, following the successful patterns already established in your cleaner admin code.
